*    ESTE REPORTE OBTIENE MOVIMIENTOS POR TRIMESTRALES
*
SELECT 1
USE &XPATCB\CUENTA INDEX &XPATCB\CUENTA ALIAS CUENTA
SELECT 3
USE &XPATCB\POLIZA INDEX &XPATCB\POLCTA
SET RELATION TO STR(CUENTA,4)+STR(SCUENTA,4)+STR(0,3)+STR(0,3) INTO CUENTA
@ 4, 1 TO 21,78 CLEAR
@23, 1 SAY SPACE(78)
XTITULO = 'REPORTE DE MOVIMIENTOS POR TRIMESTRE'
SINO    = 'S'
XDEST   = 'T'
STORE 0 TO XCUENTA,XSCUENTA,XSSCUENTA,XSSSCUENTA
@5,20 SAY XTITULO
SELECT 1
ON KEY LABEL F1 DO BCUENTA
@9,10  SAY 'Teclee el Numero de Cuenta  : ' GET XCUENTA PICT '9999'
@23,20 SAY '<F1> Lista          <ESC> Terminar'
READ
ON KEY LABEL F1
IF LASTKEY() = 27
   CLOSE DATABASES
   RETURN
ENDIF
@23, 1 SAY SPACE(78)
@18,20 SAY 'Informacion en <I>mpresora o <T>erminal  ' GET XDEST PICT '@M I,T'
@23,25 SAY '<ESC> Terminar'
READ
IF LASTKEY() = 27
   CLOSE DATABASES
   RETURN
ENDIF
@23, 1 SAY SPACE(78)
SET COLOR TO 7*
@23,20 SAY 'FAVOR DE ESPERAR UN MOMENTO ....'
SET COLOR TO &XCOLOR
SELECT 3
IF XCUENTA <> 0
   SET FILTER TO CUENTA = XCUENTA
   GO TOP
ENDIF   
IF EOF ()
   WAIT 'NO EXISTE INFORMACION DE LA CUENTA' WIND
   CLOSE DATABASES
   RETURN
ENDIF
NPAG  = 0
N     = NLPP
XNLPP = NLPP
SET DEVICE TO PRINT
IF XDEST = 'T'
   XT=XTERMINAL+'.TXT'
   SET PRINTER TO &XT
ENDIF
??? CHR(15)
STORE 0 TO XSALDO01,XSALDO02,XSALDO03,XSALDO04,XSALDO05,XSALDO06
DO WHILE .NOT. EOF()
   YCUENTA = CUENTA
   DO WHILE YCUENTA = CUENTA .AND. .NOT. EOF()
      IF N>=XNLPP
         NPAG = NPAG + 1
         @0, 1  SAY FFFFFF
         @0,124 SAY 'PAGINA :'
         @0,133 SAY NPAG PICT '999'
         IF XDEST = 'I'
            ??? CHR(18)+CHR(14)
            @1,(44-LEN(XCIA))/2 SAY XCIA
            ??? CHR(15)+CHR(14)
            @2,(70-LEN(XTITULO))/2 SAY XTITULO
         ELSE
            @1,(137-LEN(XCIA))/2 SAY XCIA
            @2,(137-LEN(XTITULO))/2 SAY XTITULO
            XNLPP = 10000
         ENDIF
         @4,20  SAY 'N O M B R E'
         @4,35  SAY '1er Trimestre '
         @4,52  SAY '2do Trimestre '
         @4,69  SAY '3er Trimestre '
         @4,86  SAY '4to Trimestre '
         @4,103 SAY 'T O T A L    '
         @5, 1 SAY REPLICATE('=',135)
         N=5
      ENDIF
      XSCUENTA = SCUENTA
      XNOMBRE = CUENTA->NOMBRE
      STOR 0 TO XT1,XT2,XT3,XT4
      DO WHILE YCUENTA = CUENTA .AND. XSCUENTA = SCUENTA .AND. .NOT. EOF()
         DO CASE
         CASE MONTH(FECHA) >= 1 .AND. MONTH(FECHA) <= 3
              XT1 =XT1+VALOR
         CASE MONTH(FECHA) >= 4 .AND. MONTH(FECHA) <= 6
              XT2 =XT2+VALOR
         CASE MONTH(FECHA) >= 7 .AND. MONTH(FECHA) <= 9
              XT3 =XT3+VALOR
         CASE MONTH(FECHA) >= 10 .AND. MONTH(FECHA) <= 12
              XT4 =XT4+VALOR
         ENDCASE
         SKIP
      ENDDO
      N=N+1
      @N,1   SAY YCUENTA PICT '9999'
      @N,5   SAY XSCUENTA PICT '9999'
      @N,12  SAY XNOMBRE PICT 'XXXXXXXXXXXXXXXXXXXXXX'
      @N,35  SAY XT1  PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,52  SAY XT2  PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,69  SAY XT3  PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,86  SAY XT4  PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,103 SAY XT1+XT2+XT3+XT4  PICT '9,999,999,999.99' FUNCTION 'Z'
   ENDDO
ENDDO   
EJECT
SET DEVICE TO SCREEN
CLOSE DATABASES
IF XDEST = 'T'
   DO TERMINAL
ENDIF
RETURN
