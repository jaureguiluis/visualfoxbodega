*    GENERA LOS SALDOS DE LAS CUENTAS A PARTIR DE LAS POLIZAS
*
@ 4, 1 TO 21,78 CLEAR
@23, 1 SAY SPACE(77)
SINO = 'NO'
@13,20 SAY 'GENERA LOS SALDOS DE LAS CUENTAS POR CADA MES'
@14,20 SAY 'PARTIENDO DE LOS REGISTROS DE CADA UNA DE LAS POLIZAS'
@23,20 SAY 'DESEA CONTINUAR SI/NO ? ' GET SINO PICT '@M SI,NO'
READ
IF SINO <> 'SI'
   RETURN
ENDIF
SINO = 'NO'
@23,20 SAY 'ESTA SEGURO QUE DESEA CONTINUAR SI/NO ? ' GET SINO PICT '@M SI,NO'
READ
IF SINO <> 'SI'
   RETURN
ENDIF
SET COLOR TO 7*
@20,20 SAY 'FAVOR DE ESPERAR UN MOMENTO ....'
SET COLOR TO &XCOLOR
SELECT 1
USE &XPATCB\CUENTA INDEX &XPATCB\CUENTA
REPLACE ALL CARGOS WITH 0,ABONOS WITH 0
SELECT 2
USE &XPATCB\SALDOS INDEX &XPATCB\SALDOS
ZAP
SELECT 3
USE &XPATCB\POLIZA INDEX &XPATCB\POLCTA
GO TOP
DO WHILE  .NOT. EOF()
   XCUENTA = CUENTA
   XSCUENTA = SCUENTA
   XSSCUENTA = SSCUENTA
   XSSSCUENTA = SSSCUENTA
   STORE 0 TO XCARGOS,XABONOS
   DO WHILE STR(XCUENTA,4)+STR(XSCUENTA,4)+STR(XSSCUENTA,3)+STR(XSSSCUENTA,3) = STR(CUENTA,4)+STR(SCUENTA,4)+STR(SSCUENTA,3)+STR(SSSCUENTA,3) .AND. .NOT. EOF()
      XMESPOL = MONTH(FECHA)
      DO WHILE STR(XCUENTA,4)+STR(XSCUENTA,4)+STR(XSSCUENTA,3)+STR(XSSSCUENTA,3) = STR(CUENTA,4)+STR(SCUENTA,4)+STR(SSCUENTA,3)+STR(SSSCUENTA,3)  .AND. .NOT. EOF()
         IF MOVIMIENTO = '+'
            XCARGOS = XCARGOS + VALOR
         ELSE
            XABONOS = XABONOS + VALOR
         ENDIF
         SKIP
         IF MONTH(FECHA) <> XMESPOL
            EXIT
         ENDIF
      ENDDO
      SELECT 2
      SEEK STR(XCUENTA,4)+STR(XSCUENTA,4)+STR(XSSCUENTA,3)+STR(XSSSCUENTA,3)+STR(XMESPOL,2,0)
      IF EOF()
         APPEND BLANK
         REPLACE CUENTA WITH XCUENTA,PERIODO WITH XMESPOL,SCUENTA WITH XSCUENTA
         REPLACE SSCUENTA WITH XSSCUENTA,SSSCUENTA WITH XSSSCUENTA
      ENDIF
      REPLACE CARGOS WITH XCARGOS,ABONOS WITH XABONOS
      SELECT 3
   ENDDO
   
ENDDO
CLOSE DATABASES
RETURN
