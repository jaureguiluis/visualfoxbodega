*    ESTE REPORTE MOVIMIENTOS MENSUALES
*
SELECT 1
USE &XPATCB\CUENTA INDEX &XPATCB\CUENTA ALIAS CUENTA
@ 4, 1 TO 21,78 CLEAR
@23, 1 SAY SPACE(78)
XTITULO = 'REPORTE DE MOVIMIENTOS POR MES'
SINO    = 'S'
XDEST   = 'T'
XCUENTA = 0
@5,20 SAY XTITULO
SELECT 1
ON KEY LABEL F1 DO BCUENTA
@7,10  SAY 'Teclee el Numero de Cuenta  : ' GET XCUENTA PICT '9999'
@23,20 SAY '<F1> Lista          <ESC> Terminar'
READ
ON KEY LABEL F1
IF LASTKEY() = 27
   CLOSE DATABASES
   RETURN
ENDIF
@23, 1 SAY SPACE(78)
@18,20 SAY 'Informacion en <I>mpresora o <T>erminal  ' GET XDEST PICT '@M I,T'
@23,25 SAY '<ESC> Terminar'
READ
IF LASTKEY() = 27
   CLOSE DATABASES
   RETURN
ENDIF
@23, 1 SAY SPACE(78)
SET COLOR TO 7*
@23,20 SAY 'FAVOR DE ESPERAR UN MOMENTO ....'
SET COLOR TO &XCOLOR

SELECT 3
*USE &XPATCB\POLIZA INDEX &XPATCB\POLCTA
USE &XPATCB\POLIZA
copy struc to &XTERMINAL
USE &XTERMINAL
INDEX ON STR(CENTRO)+STR(CUENTA)+STR(SCUENTA)+STR(SSCUENTA)+STR(SSSCUENTA) TO &XTERMINAL
APPEND FROM \43\CB\431997\POLIZA FOR CUENTA = XCUENTA
APPEND FROM \43\CB\441997\POLIZA FOR CUENTA = XCUENTA
APPEND FROM \43\CB\891997\POLIZA FOR CUENTA = XCUENTA
APPEND FROM \43\CB\901997\POLIZA FOR CUENTA = XCUENTA
APPEND FROM \43\CB\3211997\POLIZA FOR CUENTA = XCUENTA
GO TOP
IF EOF ()
   WAIT 'NO EXISTE INFORMACION DE LA CUENTA' WIND
   CLOSE DATABASES
   RETURN
ENDIF
NPAG  = 0
N     = NLPP
XNLPP = NLPP
SET DEVICE TO PRINT
IF XDEST = 'T'
   XT=XTERMINAL+'.TXT'
   SET PRINTER TO &XT
ELSE
   @0,0 SAY CHR(15)
ENDIF
   DO WHILE .NOT. EOF()
      IF N>=XNLPP
         NPAG = NPAG + 1
         @1, 1  SAY FFFFFF
         @1,124 SAY 'PAGINA :'
         @1,133 SAY NPAG PICT '999'
         IF XDEST = 'I'
            @2,0   SAY CHR(18)+CHR(14)
            @2,(44-LEN(XCIA))/2 SAY XCIA
            @3,0   SAY CHR(15)+CHR(14)
            @3,(70-LEN(XTITULO))/2 SAY XTITULO
         ELSE
            @2,(137-LEN(XCIA))/2 SAY XCIA
            @3,(137-LEN(XTITULO))/2 SAY XTITULO
            XNLPP = 10000
         ENDIF
         @6,35  SAY '   ENERO'
         @6,52  SAY '  FEBRERO'
         @6,69  SAY '   MARZO'
         @6,86  SAY '   ABRIL'
         @6,103 SAY '    MAYO'
         @6,120 SAY '    JUNIO'
         @6,137 SAY '    JULIO'
         @6,154 SAY '    AGOSTO'
         @6,171 SAY '  SEPTIEMBRE'
         @6,188 SAY '    OCTUBRE'
         @6,205 SAY '   NOVIEMBRE'
         @6,222 SAY '   DICIEMBRE'
         @7, 1 SAY REPLICATE('=',232)
         N=7
      ENDIF
      STORE 0 TO XT1,XT2,XT3,XT4,XT5,XT6,XT7,XT8,XT9,XT10,XT11,XT12
      YCENTRO   = CENTRO
      YCUENTA   = CUENTA
      YSCUENTA  = SCUENTA
      YSSCUENTA = SSCUENTA
      YSSSCUENTA= SSSCUENTA
      SELECT 1
      SEEK STR(YCUENTA,4)+STR(YSCUENTA,4)+STR(YSSCUENTA,3)+STR(YSSSCUENTA,3)
      YNOMBRE = NOMBRE
      SELECT 3
      DO WHILE YCENTRO = CENTRO .AND. YCUENTA = CUENTA .AND. YSCUENTA = SCUENTA .AND. YSSCUENTA = SSCUENTA .AND. YSSSCUENTA = SSSCUENTA .AND. .NOT. EOF()
         IF MOVIMIENTO = '-'
            XVALOR = VALOR * -1
         ELSE   
            XVALOR = VALOR 
         ENDIF   
         DO CASE
         CASE MONTH(FECHA) = 1
              XT1 =XT1+XVALOR
         CASE MONTH(FECHA) = 2
              XT2 =XT2+XVALOR
         CASE MONTH(FECHA) = 3
              XT3 =XT3+XVALOR
         CASE MONTH(FECHA) = 4
              XT4 =XT4+XVALOR
         CASE MONTH(FECHA) = 5
              XT5 =XT5+XVALOR
         CASE MONTH(FECHA) = 6
              XT6 =XT6+XVALOR
         CASE MONTH(FECHA) = 7
              XT7 =XT7+XVALOR
         CASE MONTH(FECHA) = 8
              XT8 =XT8+XVALOR
         CASE MONTH(FECHA) = 9
              XT9 =XT9+XVALOR
         CASE MONTH(FECHA) = 10
              XT10 =XT10+XVALOR
         CASE MONTH(FECHA) = 11
              XT11 =XT11+XVALOR
         CASE MONTH(FECHA) = 12
              XT12 =XT12+XVALOR
         ENDCASE
         SKIP
      ENDDO
      N=N+1
      @N,1   SAY YNOMBRE PICT 'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'
      @N,35  SAY XT1  PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,52  SAY XT2  PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,69  SAY XT3  PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,86  SAY XT4  PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,103 SAY XT5  PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,120 SAY XT6  PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,137 SAY XT7  PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,154 SAY XT8  PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,171 SAY XT9  PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,188 SAY XT10 PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,205 SAY XT11 PICT '9,999,999,999.99' FUNCTION 'Z'
      @N,222 SAY XT12 PICT '99,999,999.99'    FUNCTION 'Z'
      @N,236 SAY YCENTRO PICT '99999'    FUNCTION 'Z'
   ENDDO
EJECT
SET DEVICE TO SCREEN
CLOSE DATABASES
IF XDEST = 'T'
   DO TERMINAL
ENDIF
RETURN
