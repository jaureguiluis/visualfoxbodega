*  INTERFASE DE LOS MOVIMIENTOS DE LA CONTABILIDAD DE ADSYS
*
store date() to xfechai,xfechaf
set safety off
SET DATE TO mdy
clear
@10,10 say 'FECHA INICIAL :  ' get xfechai PICT '@E'
@12,10 say 'FECHA FINAL :    ' get xfechaf PICT '@E'
@14,10 say 'POR MEDIO DEL ADDBM EXPORTA LOS REGISTROS A UN ARCHIVO EN '
@15,10 say 'EN EL DIRECTORIO DE CADA EMPRESA CON EL NOMBRE DE CONMOVDB.TXT '
@16,10 say 'EJEMPLO :  F:\4S\CB\432001\CONMOVDB.TXT '
@17,10 say 'ESTE PROCESO BORRA LOS REGISTROS Y PONE LOS DE ADSYS'
@19,10 say 'LAS MODIFICACIONES QUE SE EJECUTARON SE PIERDEN Y SE VUELVEN HACER'
read
IF LASTKEY() = 27
   CLOSE DATA
   RETURN
ENDIF   
XE = SUBSTR(XPATCB,2,1)
IF XE = "3"
   run \adsys\addbm\addbm -p \BODEGA\ARCH\exporta3
ENDIF
IF XE = "4"
   run \adsys\addbm\addbm -p \BODEGA\ARCH\exporta4
ENDIF
IF XE = "6"
   run \adsys\addbm\addbm -p \BODEGA\ARCH\exporta6
ENDIF
IF XE = "8"
   run \adsys\addbm\addbm -p \BODEGA\ARCH\exporta8
ENDIF
SET DATE TO ANSI
   select 1
   use &XPATCB\interfase EXCL
   ZAP
   append from &XPATCB\conmovdb.txt type sdf
   SELECT 2
   use &XPATCB\POLIZA INDEX &XPATCB\POLcta,&XPATCB\POLIZA
   set filter to fecha >= xfechai .and. fecha <=xfechaf
   DELETE ALL

SELECT 1
set filter to fecha >= xfechai .and. fecha <=xfechaf
GO TOP
DO WHILE .NOT. EOF()
   XCUENTA = CUENTA
   XSCUENTA = SCUENTA
   XSSCUENTA = SSCUENTA
   XSSSCUENTA = SSSCUENTA
   XREFERENCIA = REFERENCIA
   XCONCEPTO   = CONCEPTO+SPACE(10)
   XFECHA      = FECHA
   XPERIODO    = MONTH(FECHA)
   XPOLIZA     = POLIZA
   IF VALOR > 0
      XMOVI = '+'
      XVALOR = VALOR 
   ELSE
      XMOVI = '-'
      XVALOR = VALOR * -1
   ENDIF  
   XTIPO = ' ' 
   DO CASE
      CASE TIPO = 'd'
         XTIPO = 'D'
      CASE TIPO = 'i'
         XTIPO = 'I'
      CASE TIPO = 'e'
         XTIPO = 'E'
      CASE TIPO = 's'
         XTIPO = 'S'
      CASE TIPO = 'o'
         XTIPO = 'O'
   ENDCASE
   SELECT 2
      APPEND BLANK
      REPLACE CUENTA WITH XCUENTA,SCUENTA WITH XSCUENTA,SSCUENTA WITH XSSCUENTA,SSSCUENTA WITH XSSSCUENTA
      REPLACE REFERENCIA WITH XREFERENCIA,CONCEPTO WITH XCONCEPTO,VALOR WITH XVALOR,POLIZA WITH XPOLIZA
      REPLACE MOVIMIENTO WITH XMOVI,TIPO WITH XTIPO,FECHA WITH XFECHA,PERIODO WITH XPERIODO,REGISTRO WITH RECNO()
      
      IF CUENTA = 1130 .AND. SUBSTR(CONCEPTO,1,2) = '**' .AND. ARTICULO = '  '
         REPLACE ARTICULO WITH ALLTRIM(SUBSTR(CONCEPTO,3,8))
      ENDIF
      IF CUENTA = 1130 .AND. SUBSTR(CONCEPTO,1,1) = '*' .AND. ARTICULO = '  '
         REPLACE ARTICULO WITH ALLTRIM(SUBSTR(CONCEPTO,2,9))
      ENDIF
      IF CUENTA = 1130 .AND. SUBSTR(CONCEPTO,1,1) = '%' .AND. ARTICULO = '  '
         REPLACE ARTICULO WITH ALLTRIM(SUBSTR(CONCEPTO,2,9))
      ENDIF
      IF CUENTA = 1130 .AND. ARTICULO = '  '
         REPLACE ARTICULO WITH ALLTRIM(SUBSTR(XCONCEPTO,1,10))
      ENDIF

      IF CUENTA = 1135 .AND. SUBSTR(CONCEPTO,1,2) = '**' .AND. ARTICULO = '  '
         REPLACE ARTICULO WITH ALLTRIM(SUBSTR(CONCEPTO,3,8))
      ENDIF
      IF CUENTA = 1135 .AND. SUBSTR(CONCEPTO,1,1) = '*' .AND. ARTICULO = '  '
         REPLACE ARTICULO WITH ALLTRIM(SUBSTR(CONCEPTO,2,9))
      ENDIF
      IF CUENTA = 1135 .AND. SUBSTR(CONCEPTO,1,1) = '%' .AND. ARTICULO = '  '
         REPLACE ARTICULO WITH ALLTRIM(SUBSTR(CONCEPTO,2,9))
      ENDIF
      IF CUENTA = 1135 .AND. ARTICULO = '  '
         REPLACE ARTICULO WITH ALLTRIM(SUBSTR(XCONCEPTO,1,10))
      ENDIF
      
      ?recno()
   SELECT 1
   SKIP
ENDDO
CLOSE DATABASES
SET DATE TO DMY
RETURN
  