*  INTERFASE DE LOS MOVIMIENTOS DE LA CONTABILIDAD DE ADSYS
*  AGREGA REGISTROS 
store date() to xfechai,xfechaf
set safety off
xempresa = 0
SET DATE TO mdy
clear
@10,10 say 'FECHA INICIAL :  ' get xfechai PICT '@E'
@12,10 say 'FECHA FINAL :    ' get xfechaf PICT '@E'
@14,10 say 'POR MEDIO DEL ADDBM EXPORTA LOS REGISTROS A UN ARCHIVO EN '
@15,10 say 'EN EL DIRECTORIO DE CADA EMPRESA CON EL NOMBRE DE CONMOVDB.TXT '
@16,10 say 'EJEMPLO :  F:\43\CB\431997\CONMOVDB.TXT '
@17,10 say 'ESTE PROCESO SOLO AGREGA LOS REGISTRO NO REPETIDOS'
read
IF LASTKEY() = 27
   CLOSE DATA
   RETURN
ENDIF   
SET DATE TO ANSI
   select 1
   use &XPATCB\interfase EXCL
   ZAP
   append from &XPATCB\conmovdb.txt type sdf
   SELECT 2
   use &XPATCB\POLIZA
   INDEX ON  STR(CUENTA,4)+STR(SCUENTA,4)+STR(SSCUENTA,3)+STR(SSSCUENTA,3)+DTOC(FECHA)+TIPO+STR(POLIZA,4,0)+REFERENCIA+STR(VALOR,15,2) TO INTERFASE
   SELECT 2
   use &XPATCB\POLIZA INDEX INTERFASE,&XPATCB\POLcta,&XPATCB\POLIZA
   use &XPATCB\POLIZA INDEX &XPATCB\POLcta,&XPATCB\POLIZA

SELECT 1
set filter to fecha >= xfechai .and. fecha <=xfechaf
GO TOP
DO WHILE .NOT. EOF()
   XCUENTA = CUENTA
   XSCUENTA = SCUENTA
   XSSCUENTA = SSCUENTA
   XSSSCUENTA = SSSCUENTA
   XREFERENCIA = REFERENCIA
   XCONCEPTO   = CONCEPTO+SPACE(10)
   XFECHA      = FECHA
   XPERIODO    = MONTH(FECHA)
   XPOLIZA     = POLIZA
   IF VALOR > 0
      XMOVI = '+'
      XVALOR = VALOR 
   ELSE
      XMOVI = '-'
      XVALOR = VALOR * -1
   ENDIF  
   XTIPO = ' ' 
   DO CASE
      CASE TIPO = 'd'
         XTIPO = 'D'
      CASE TIPO = 'i'
         XTIPO = 'I'
      CASE TIPO = 'e'
         XTIPO = 'E'
      CASE TIPO = 's'
         XTIPO = 'S'
      CASE TIPO = 'o'
         XTIPO = 'O'
   ENDCASE
   SELECT 2
   seek  STR(XCUENTA,4)+STR(XSCUENTA,4)+STR(XSSCUENTA,3)+STR(XSSSCUENTA,3)+DTOC(XFECHA)+XTIPO+STR(XPOLIZA,4,0)+XREFERENCIA+STR(XVALOR,15,2)
   IF  EOF()
      APPEND BLANK
      REPLACE CUENTA WITH XCUENTA,SCUENTA WITH XSCUENTA,SSCUENTA WITH XSSCUENTA,SSSCUENTA WITH XSSSCUENTA
      REPLACE REFERENCIA WITH XREFERENCIA,CONCEPTO WITH XCONCEPTO,VALOR WITH XVALOR,POLIZA WITH XPOLIZA
      REPLACE MOVIMIENTO WITH XMOVI,TIPO WITH XTIPO,FECHA WITH XFECHA,PERIODO WITH XPERIODO,REGISTRO WITH RECNO()
      ?recno()
   ELSE
     SELECT 1
     REPLACE MOVIMIENTO WITH "N"   
   ENDIF
   SELECT 1
   SKIP
ENDDO
CLOSE DATABASES
SET DATE TO DMY
RETURN
  