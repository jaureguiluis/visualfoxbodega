*    CONSULTA TOTALES POR POLIZA
*
@ 4, 1 TO 21,78 CLEAR
@23, 1 SAY SPACE(78)
SINO = 'S'
STORE DATE() TO XFECHAI,XFECHAF
XFECHAI = XFECHAI-DAY(XFECHAI)+1
@5,20  SAY 'Consulta Totales por Poliza'
@10,20 SAY 'Teclee Fecha Inicial de la Poliza : ' GET XFECHAI
@12,20 SAY 'Teclee Fecha Final de la Poliza :   ' GET XFECHAF
@23,25 SAY '<ESC> Terminar'
READ
IF LASTKEY() = 27
   RETURN
ENDIF
SET DATE ANSI

SELECT 3
USE &XPATCB\POLIZA INDEX &XPATCB\POLIZA
DO WHILE .T.
   SEEK DTOC(XFECHAI)
   IF EOF()
      XFECHAI = XFECHAI + 1
      IF XFECHAI > XFECHAF
         EXIT
      ENDIF
      LOOP
   ELSE
      EXIT
   ENDIF
ENDDO
IF EOF()
   WAIT 'NO EXISTE INFORMACION ENTRE DATOS DADOS  TECLEE RETURN' WIND
   CLOSE DATABASES
   RETURN
ENDIF
@ 4, 1 TO 21,78 CLEAR
@23, 1 SAY SPACE(77)
N = 4
@4,1  SAY 'REGS.'
@4,8  SAY 'FECHA'
@4,14 SAY 'TIPO'
@4,19 SAY 'POLIZA'
@4,25 SAY '   TOTAL CARGOS'
@4,44 SAY '   TOTAL ABONOS'
@4,63 SAY '    DIFERENCIA'
DO WHILE FECHA <= XFECHAF .AND. .NOT. EOF()
   STORE 0 TO XREG,XCARGOS,XABONOS
   XFECHA  = FECHA
   XPOLIZA = POLIZA
   XTIPO   = TIPO
   DO WHILE DTOC(FECHA)+TIPO+STR(POLIZA,6) = DTOC(XFECHA)+XTIPO+STR(XPOLIZA,6) .AND. .NOT. EOF()
*   DO WHILE STR(POLIZA,6) =STR(XPOLIZA,6) .AND. .NOT. EOF()
      IF N >= 21
         WAIT  'Return P/ Continuar ; <ESC>  P/ Terminar  ' WIND
         IF LASTKEY() = 27
            CLOSE DATABASES
            RETURN
         ENDIF
         @05,1 TO 21,78 CLEAR
         N = 4
      ENDIF
      XREG= XREG + 1
      IF MOVIMIENTO ='+'
         XCARGOS = XCARGOS + VALOR
      ELSE
         XABONOS = XABONOS + VALOR
      ENDIF
      IF TIPO = " "
         DELETE
      ENDIF    
      SKIP
   ENDDO
   N = N + 1
   @N,1  SAY XREG PICT '9999'
   @N,6  SAY XFECHA PICT '@E'
   @N,17 SAY XTIPO   
   @N,20 SAY XPOLIZA PICT '9999'
   @N,27 SAY XCARGOS PICT '99,999,999,999.99'
   @N,46 SAY XABONOS PICT '99,999,999,999.99'
   @N,64 SAY XCARGOS-XABONOS PICT '999,999,999.99' FUNCTION 'Z'
ENDDO
WAIT  'TECLEE RETURN PARA TERMINAR' WIND
CLOSE DATABASES
SET DATE DMY
RETURN
