*    ESTE REPORTE OBTIENE POLIZAS DE CONTABILIDAD
*
@ 4, 1 TO 21,78 CLEAR
@23, 1 SAY SPACE(77)
XTITULO = 'IMPRESION DE POLIZAS'
XDEST   = 'T'
STORE 1 TO XPOLIZA,XPOLIZAF,XTIPO
STORE DATE() TO XFECHAI,XFECHAF
*XFECHAI = XFECHAI-DAY(XFECHAI)+1
@5,20 SAY XTITULO
@7,35 SAY  'Tipo de Poliza:'
@7,51 PROMPT 'DIARIO  '
@7,51 PROMPT 'INGRESOS'
@7,51 PROMPT 'EGRESOS '
@7,51 PROMPT 'OTROS   '
@7,51 PROMPT 'INICIAL '
@7,51 PROMPT 'FINAL   '
MENU TO XTIPO
@09,20 SAY 'Teclee Numero de Poliza  :         ' GET XPOLIZA PICT '9999'
@11,20 SAY 'Teclee Fecha de la Poliza :        ' GET XFECHAI 
@19,20 SAY 'Informacion en <I>mpresora O <T>erminal ' GET XDEST PICT '@M I,T'
@23,25 SAY '<ESC> Terminar'
READ
IF LASTKEY() = 27
   RETURN
ENDIF
@23, 1 SAY SPACE(78)
SET COLOR TO 7*
@23,20 SAY 'FAVOR DE ESPERAR UN MOMENTO ....'
SET COLOR TO &XCOLOR
DO CASE
   CASE  XTIPO = 5
   XTIPO = 'S'
   CASE  XTIPO = 6
   XTIPO = 'F'
   CASE XTIPO = 1
   XTIPO = 'D'
   CASE XTIPO = 2
   XTIPO = 'I'
   CASE XTIPO = 3
   XTIPO = 'E'
   CASE XTIPO = 4
   XTIPO = 'O'
ENDCASE
SET DATE ANSI
SELECT 1
USE &XPATCB\CUENTA INDEX &XPATCB\CUENTA ALIAS CUENTA
SELECT 3
USE &XPATCB\POLIZA INDEX &XPATCB\POLIZA
SET RELATION TO STR(CUENTA,4)+STR(SCUENTA,4)+STR(SSCUENTA,3)+STR(SSSCUENTA,3) INTO CUENTA
NPAG = 0
N    = NLPP
XNLPP = NLPP
*SET FILTER TO FECHA =XFECHAI .AND. POLIZA = XPOLIZAI .AND. TIPO = XTIPO
*GO TOP
SEEK DTOC(XFECHAI)+XTIPO+STR(XPOLIZA,6)
IF EOF()
   WAIT 'NO EXISTE INFORMACION ENTRE DATOS DADOS  TECLEE RETURN' WIND
   CLOSE DATABASES
   RETURN
ENDIF
SET DEVICE TO PRINT
IF XDEST = 'T'
   XT=XTERMINAL+'.TXT'
   SET PRINTER TO &XT
ENDIF
??? CHR(15)
XTITULO = 'POLIZA '
STORE 0 TO XREG,XCARGOS,XABONOS
XFECHA  = FECHA
XPOLIZA = POLIZA
XPO=LTRIM(STR(XPOLIZA,6))
DO CASE
   CASE TIPO = 'D'
      XTITULO = 'POLIZA ' + 'DE DIARIO'
   CASE TIPO = 'I'
      XTITULO = 'POLIZA ' + 'DE INGRESOS'
   CASE TIPO = 'E'
      XTITULO = 'POLIZA ' + 'DE EGRESOS'
   CASE TIPO = 'O'
      XTITULO = 'POLIZA ' + 'INICIAL'
ENDCASE
XTITULO = XTITULO +' NUM. '+XPO+' DEL : '+STR(DAY(XFECHA),2)+' DE '+NMES(MONTH(XFECHA))+' DE '+STR(YEAR(XFECHA),4)
DO WHILE DTOC(FECHA)+TIPO+STR(POLIZA,6) = DTOC(XFECHA)+XTIPO+STR(XPOLIZA,6) .AND. .NOT. EOF()
   IF N>=XNLPP
      NPAG = NPAG + 1
      @0,4   SAY FFFFFF PICT '@E'
      @0,15  SAY TIME()
      @0,118 SAY 'PAG :'
      @0,124 SAY NPAG PICT '999'
      IF XDEST ='I'
         ??? CHR(18)+CHR(14)
         @1,(44-LEN(XCIA))/2 SAY XCIA
         ??? CHR(15)+CHR(14)
         @2,(70-LEN(XTITULO))/2 SAY XTITULO
      ELSE
         @1,20 SAY XCIA
         @2,20 SAY XTITULO
         XNLPP = 10000
      ENDIF
      @4, 1  SAY 'ASI.'
      @4,10  SAY 'CUENTA'
      @4,20  SAY 'N O M B R E'
      @4,38  SAY 'C O N C E P T O'
      @4,79  SAY 'ARTICULO'
      @4,94  SAY 'FECHA'
      @4,102 SAY 'POLIZA'
      @4,109 SAY 'REF.'
      @4,114 SAY ' C A R G O'
      @4,128 SAY 'A B O N O'
      @5, 1 SAY REPLICATE('=',136)
      N=5
   ENDIF
   N=N+1
   XREG= XREG + 1
   @N,0 SAY XREG PICT '999'
   @N,4 SAY STR(CUENTA,4)+STR(SCUENTA,4)+STR(SSCUENTA,3)+STR(SSSCUENTA,3) 
   @N,19 SAY CUENTA->NOMBRE PICT 'XXXXXXXXXXXXXXXXXX'
   @N,38 SAY CONCEPTO 
   @N,79 SAY ARTICULO
   @N,94 SAY FECHA 
   @N,105 SAY POLIZA PICT '999'
   @N,109 SAY REFERENCIA PICT 'XXXX'
   IF MOVIMIENTO = '+'
      XCARGOS = XCARGOS + VALOR
      @N,114 SAY VALOR PICT '999,999,999.99'
   ELSE
      XABONOS = XABONOS + VALOR
      @N,123 SAY VALOR PICT '999,999,999.99'
   ENDIF
   SKIP
ENDDO
N = N + 1
IF XCARGOS = XABONOS
   @N,84  SAY 'TOTAL : '
   @N,114 SAY XCARGOS PICT '999,999,999.99'
N = N + 1
   @N,123 SAY XABONOS PICT '999,999,999.99'
ELSE
   @N,10  SAY 'POLIZA NO CUADRA'
   @N,84  SAY 'TOTAL : '
   @N,114 SAY XCARGOS PICT '999,999,999.99'
N = N + 1
   @N,123 SAY XABONOS PICT '999,999,999.99'
ENDIF   
EJECT
SET DEVICE TO SCREEN
CLOSE DATABASES
IF XDEST = 'T'
   DO TERMINAL
ENDIF
RETURN
