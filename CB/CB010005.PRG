* ALTAS BAJAS Y CAMBIOS DE EMPRESAS
*
SELECT 1
USE CIAS
DO WHILE .T.
   @ 4,1  TO 21,78 CLEAR
   @ 23,1 SAY SPACE(78)
   IF MEMORY() < 90
      @10,20 SAY 'NO TIENE SUFICIENTE MEMORIA PARA DAR'
      @12,20 SAY 'DE ALTA UNA EMPRESA NUEVA'
      @14,20 SAY 'MEMORIA REQUERIDA > 95000'
      @16,20 SAY 'MEMORIA DIPONIBLE :'
      @16,40 SAY MEMORY()*1000 PICT '99999'
      WAIT ''
      CLOSE DATABASES
      RETURN
   ENDIF
   @ 4,25 SAY 'ALTAS,BAJAS Y CAMBIOS A EMPRESAS'
   SINO = 'SI'
   @ 23,6 SAY  '<F2> Agregar     '+CHR(24)+' '+CHR(25)+' Seleccionar     ';
   +CHR(17)+CHR(196)+CHR(217)+' Confirmar     <ESC> Terminar'
   ACTI POPUP POPEMPRESA
   IF LASTKEY() = 27
      EXIT
   ENDIF
   IF LASTKEY() = 4
      LOOP
   ENDIF
   IF LASTKEY() = 19
      LOOP
   ENDIF
   IF LASTKEY() = -1
      SW = 0
      STORE SPACE(40) TO XNOMBRE,XDIRECC,XCIUDAD,XNOMBRET
      STORE SPACE(15) TO XRFC
      XUNIDAD = SPACE(8)
      XNLPP   = 60
      XCTA    = 3
      XDIR    = DIR
   ELSE
      SW = 1
      XNOMBRE  = NOMBRE
      XNOMBRET = NOMBRET
      XDIRECC  = DIRECC
      XCIUDAD  = CIUDAD
      XUNIDAD  = UNIDAD
      XRFC     = RFC
      XNLPP    = NLPP
      XCTA     = CCTAMAYOR
   ENDIF
   @ 6,10   SAY 'Nombre Para Reportes : ' GET XNOMBRE
   @ 7,10   SAY 'Direccion :            ' GET XDIRECC
   @ 8,10   SAY 'Ciudad :               ' GET XCIUDAD
   @ 10,10  SAY 'R. F. C. :  ' GET XRFC
   @ 12,10  SAY 'Numero de Lineas por Pagina : ' GET XNLPP PICT '99'
   @ 14,10  SAY 'Numero de Caracteres que tiene la Cuenta de Mayor : ' GET XCTA PICT '9'
   @ 16,10  SAY 'Nombre Para Manejo Interno : ' GET XNOMBRET
   IF SW =0
      @ 20,10  SAY 'Nombre del Directorio en donde estaran '
      @ 21,10  SAY 'los Archivos de Datos (ejem:  VITRO91  ' GET XUNIDAD PICT 'XXXXXXXX'
   ENDIF
   @ 23,1  SAY SPACE(78)
   @ 23,20 SAY 'ES CORRECTA LA INFORMACION  SI/NO ? ' GET SINO PICT '!!'
   READ
   IF XUNIDAD = '        '
      LOOP
   ENDIF
   IF SINO <> 'SI'
      IF SW = 1
         SINO = 'NO'
         @ 23,1 SAY SPACE(78)
         @ 23,5 SAY 'ESTA SEGURO QUE QUIERE BORRAR LOS DATOS DE ESTA EMPRESA SI/NO ? ' GET SINO PICT '!!'
         READ
         IF SINO = 'SI'
            XUNIDAD = TRIM(XUNIDAD)
            RUN DEL &XUNIDAD\*.*
            RUN RD &XUNIDAD
            DELETE
         ENDIF
      ENDIF
      LOOP
   ENDIF
   IF SW = 0
      XUNIDAD = CURDIR()+ALLTRIM(XDIR)+'\'+TRIM(XUNIDAD)
      ?XUNIDAD
      WAIT
*      XUNIDAD = CURDIR()+TRIM(XUNIDAD)
      RUN MD &XUNIDAD
      SELECT 2
      USE CTAS
      COPY STRUC TO &XUNIDAD\CUENTA
      SELECT 2
      USE &XUNIDAD\CUENTA
      APPEND BLANK
      INDEX ON CUENTA TO &XUNIDAD\CUENTA
      USE
      SELECT 3
      USE SLDS
      COPY STRUC TO &XUNIDAD\SALDOS
      SELECT 3
      USE &XUNIDAD\SALDOS
      INDEX ON CUENTA+STR(PERIODO,2,0) TO &XUNIDAD\SALDOS
      USE
      SELECT 4
      USE PLZA
      COPY STRUC TO &XUNIDAD\POLIZA
      SELECT 4
      USE &XUNIDAD\POLIZA
      INDEX ON DTOC(FECHA)+STR(POLIZA,4,0) TO &XUNIDAD\POLIZA
      INDEX ON CUENTA+DTOC(FECHA)+STR(POLIZA,4,0) TO &XUNIDAD\POLCTA
      USE
      SELECT 1
      APPEND BLANK
      REPLACE NOMBRE WITH XNOMBRE,DIRECC WITH XDIRECC,CIUDAD WITH XCIUDAD
      REPLACE UNIDAD WITH XUNIDAD,RFC WITH XRFC,NLPP WITH XNLPP
      REPLACE CCTAMAYOR WITH XCTA,NOMBRET WITH XNOMBRET
   ENDIF
   IF SW = 1
      REPLACE NOMBRE WITH XNOMBRE,DIRECC WITH XDIRECC,CIUDAD WITH XCIUDAD
      REPLACE RFC WITH XRFC,NLPP WITH XNLPP,COLOR WITH 'W'
      REPLACE CCTAMAYOR WITH XCTA,NOMBRET WITH XNOMBRET
   ENDIF
   EXIT
ENDDO
CLOSE DATABASES
RETURN