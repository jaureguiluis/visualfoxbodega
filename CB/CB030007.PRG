*    ESTE REPORTE OBTIENE EL ESTADO DE RESULTADOS
*
XPOSCTA = 2
XPOSAUX = 4
@ 4, 1 TO 21,78 CLEAR
@23, 1 SAY SPACE(78)
XTITULO = 'ESTADO DE RESULTADOS'
SINO    = 'S'
XDEST   = 'I'
XFECHA  = FFFFFF
@5,20 SAY XTITULO
@10,20 SAY 'Teclee Fecha del Estado de Resultados :  ' GET XFECHA
@18,20 SAY 'Informacion en <I>mpresora o <T>erminal ' GET XDEST PICT '@M I,T'
@23,25 SAY '<ESC> Terminar'
READ
IF LASTKEY() = 27
   RETURN
ENDIF
XMESRES = MONTH(XFECHA)
XTITULO = XTITULO + ' AL '+STR(DAY(XFECHA),2)+' DE '+NMES(XMESRES)+' DE '+STR(YEAR(XFECHA),4)
@23, 1 SAY SPACE(78)
SET COLOR TO 7*
@23,20 SAY 'FAVOR DE ESPERAR UN MOMENTO ....'
SET COLOR TO &XCOLOR
SELECT 1
USE &XPATCB\CUENTA INDEX &XPATCB\CUENTA ALIAS CUENTA
SELECT 2
USE &XPATCB\SALDOS INDEX &XPATCB\SALDOS
SET RELATION TO SUBSTR(CUENTA,1,4) INTO CUENTA
SET FILTER TO CUENTA > '3'
GO TOP
NPAG  = 0
N     = NLPP
XNLPP = NLPP
SET DEVICE TO PRINT
IF XDEST = 'T'
   XT=XTERMINAL+'.TXT'
   SET PRINTER TO &XT
ELSE
   @0,0 SAY CHR(18)
ENDIF
STORE 0 TO XTACTIVO,XTPASIVO,XTCAPITAL,XTINGRESOS,XTEGRESOS,XSALDO,XTSALDO
STORE 0 TO XTCOSTOS,XTGASTOS,XRESULTADO,XTTSALDO,XUTBRUTA
DO WHILE .NOT. EOF()
   XCUENTA = SUBSTR(CUENTA,1,1)
   DO WHILE XCUENTA = SUBSTR(CUENTA,1,1) .AND. .NOT. EOF()
      XSUBCUENTA = SUBSTR(CUENTA,1,2)
      DO WHILE XSUBCUENTA = SUBSTR(CUENTA,1,2) .AND. .NOT. EOF()
         IF N>=XNLPP
            NPAG = NPAG + 1
            @1,10  SAY FFFFFF
            @1,69  SAY 'PAGINA :'
            @1,78  SAY NPAG PICT '999'
            IF XDEST = 'I'
               @2,0   SAY CHR(14)
               @2,(44-LEN(XCIA))/2 SAY XCIA
               @3,0   SAY CHR(15)+CHR(14)
               @3,(70-LEN(XTITULO))/2 SAY XTITULO
               @4,0 SAY CHR(18)
            ELSE
               @2,(80-LEN(XCIA))/2 SAY XCIA
               @3,(80-LEN(XTITULO))/2 SAY XTITULO
               XNLPP = 10000
            ENDIF
            @6,20  SAY 'C U E N T A'
            @6,60  SAY '  I M P O R T E'
            @7,10  SAY REPLICATE('=',66)
            N=9
         ENDIF
         XAUXILIAR = SUBSTR(CUENTA,1,XPOSAUX)
         XNOMBRE = CUENTA->NOMBRE
         DO WHILE XAUXILIAR = SUBSTR(CUENTA,1,XPOSAUX) .AND. .NOT. EOF()
            IF PERIODO = XMESRES
               XSALDO = XSALDO + CARGOS - ABONOS
            ENDIF
            SKIP
         ENDDO
         IF XSALDO <> 0
            N=N+2
            @N,1 SAY XAUXILIAR
            @N,15 SAY XNOMBRE
            IF XCUENTA = '4'
               @N,60 SAY XSALDO*-1  PICT '9999,999,999.99'
            ELSE
               @N,60 SAY XSALDO  PICT '9999,999,999.99'
            ENDIF
         ENDIF
         XTSALDO = XTSALDO + XSALDO
         STORE 0 TO XSALDO
      ENDDO
*      IF XTSALDO <> 0
*         N = N + 1
*         @N,60 SAY '---------------'
*         N = N + 1
*         @N,10 SAY 'S U B-T O T A L '
*         @N,60 SAY XTSALDO  PICT '9999,999,999.99'
*         N = N + 2
*      ENDIF
      XTTSALDO = XTTSALDO + XTSALDO
      STORE 0 TO XTSALDO
   ENDDO
   IF XCUENTA = '4'
      N = N + 1
      @N,60 SAY '---------------'
      N = N + 1
      @N,10 SAY 'TOTAL VENTAS'
      @N,60 SAY XTTSALDO*-1  PICT '9999,999,999.99'
      N = N + 9
      XTINGRESOS = XTTSALDO
   ENDIF
   IF XCUENTA = '5'
      N = N + 1
      @N,60 SAY '---------------'
      N = N + 1
      @N,10 SAY 'TOTAL COSTOS'
      @N,60 SAY XTTSALDO  PICT '9999,999,999.99'
      N = N + 5
      XTCOSTOS = XTTSALDO
      XUTBRUTA = XTINGRESOS + XTCOSTOS
      IF XUTBRUTA < 0
         @N,10 SAY 'UTILIDAD BRUTA'
         @N,60 SAY  XUTBRUTA*-1 PICT '9999,999,999.99'
      ELSE
         @N,10 SAY 'PERDIDA BRUTA'
         @N,60 SAY  XUTBRUTA PICT '9999,999,999.99'
      ENDIF
      N = N + 5
   ENDIF
   IF XCUENTA = '6'
      N = N + 1
      @N,60 SAY '---------------'
      N = N + 1
      @N,10 SAY 'TOTAL GASTOS'
      @N,60 SAY XTTSALDO  PICT '9999,999,999.99'
      N = N + 2
      XTGASTOS = XTTSALDO
   ENDIF
   IF XCUENTA = '7'
      XTGASTOS = XTGASTOS+XTTSALDO
   ENDIF
   XTTSALDO = 0
ENDDO
*XTEGRESOS = XTCOSTOS + XTGASTOS
*XRESULTADO = XTINGRESOS-XTEGRESOS
XRESULTADO = XUTBRUTA + XTGASTOS
IF XRESULTADO < 0
   N = N + 1
   @N,10 SAY 'UTILIDAD DE OPERACION'
   @N,60 SAY XRESULTADO*-1  PICT '9999,999,999.99'
ENDIF
IF XRESULTADO > 0
   N = N + 1
   @N,10 SAY 'PERDIDA DE OPERACION'
   @N,60 SAY XRESULTADO  PICT '9999,999,999.99'
ENDIF
EJECT
SET DEVICE TO SCREEN
CLOSE DATABASES
IF XDEST = 'T'
   DO TERMINAL
ENDIF
RETURN
