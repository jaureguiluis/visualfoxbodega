*   GENERA LA POLIZA 2 DE INGRESOS FICHAS
*
STORE FFFFFF TO XFECHA,XFECHAF
@4,1 TO 21,78 CLEAR
@23,1 SAY SPACE(78)
XTITULO = 'POLIZA DE INGRESOS'
@6,20  SAY XTITULO
@10,20 SAY 'Fecha de Poliza Inicial : ' GET XFECHA
@12,20 SAY 'Fecha de Poliza Final :   ' GET XFECHAF
@23,20 SAY '      <ESC> Terminar'
READ
IF LASTKEY() = 27 
   RETURN
ENDIF
SET COLOR TO 7*
@20,20 SAY 'FAVOR DE ESPERAR UN MOMENTO ....'
SET COLOR TO &XCOLOR
@ 23,1  SAY SPACE(78)
SET DATE ANSI
XMESPOL = MONTH(XFECHA)
SELECT 1
USE CCBANCOS INDEX CCBANCOS
SELECT 3
USE &XPATCB\POLIZA INDEX &XPATCB\POLIZA,&XPATCB\POLCTA
SEEK DTOC(XFECHA)+"I"+STR(2,6,0)
IF .NOT. EOF()
   WAIT 'CUIDADO YA EXISTE UNA POLIZA CON ESTOS DATOS ' WIND
   CLOSE DATABASES
   RETURN
ENDIF   
COPY STRUC TO &XTERMINAL
SELECT 6
USE &XTERMINAL
XARC=SUBSTR(XTERMINAL,1,7)
SELECT 9
USE VTFICHAS  
SORT ON TIPO,BANCO FOR FECHA >= XFECHA .AND. FECHA <= XFECHAF TO &XARC
SELECT 9
USE &XARC
IF EOF()
   SET DATE DMY
   CLOSE DATABASES
   RETURN
ENDIF   
STORE 0 TO XTCOBRANZA,XTPISO,XTCONTADO
DO WHILE .NOT. EOF()
   STORE 0 TO XTVALOR
   XBANCO  = BANCO
   DO WHILE BANCO = XBANCO .AND. .NOT. EOF()
      XTVALOR    = XTVALOR    + VALOR
      XCHEQUE    = CHEQUE
      IF TIPO = 'CON'
         XTCONTADO  = XTCONTADO + VALOR
      ENDIF
      IF TIPO = 'COB'
         XTCOBRANZA = XTCOBRANZA + VALOR
      ENDIF
      IF TIPO = 'COM'
         XTPISO = XTPISO + VALOR
      ENDIF
      SKIP
   ENDDO
   IF XTVALOR <>0
      SELECT 1
      SEEK XBANCO
      XCUENTA    = CUENTA
      XSCUENTA   = SCUENTA
      XSSCUENTA  = SSCUENTA
      XSSSCUENTA = SSSCUENTA
      SELECT 6
      APPEND BLANK
      REPLACE FECHA WITH XFECHA,POLIZA WITH 2
      REPLACE CUENTA WITH XCUENTA,SCUENTA WITH XSCUENTA,SSCUENTA WITH 1,SSSCUENTA WITH 0
      REPLACE VALOR WITH XTVALOR,MOVIMIENTO WITH '+'
      REPLACE TIPO WITH 'I',REFERENCIA WITH STR(XCHEQUE),PERIODO WITH XMESPOL
   ENDIF
   SELECT 9
ENDDO


SELECT 6
IF XTCOBRANZA <> 0
   APPEND BLANK
   REPLACE FECHA WITH XFECHA,POLIZA WITH 2
   REPLACE CUENTA WITH 1110,SCUENTA WITH 1,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE VALOR WITH XTCOBRANZA,MOVIMIENTO WITH '-'
   REPLACE TIPO WITH 'I',PERIODO WITH XMESPOL
   IF SUBSTR(PAT,2,2) = "89"
      REPLACE SCUENTA WITH 50
   ENDIF   
ENDIF

IF XTCONTADO <> 0
   APPEND BLANK
   REPLACE FECHA WITH XFECHA,POLIZA WITH 2
   REPLACE CUENTA WITH 4101,SCUENTA WITH 1,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE VALOR WITH XTCONTADO,MOVIMIENTO WITH '-'
   REPLACE TIPO WITH 'I',PERIODO WITH XMESPOL
ENDIF

IF XTPISO <> 0
   APPEND BLANK
   REPLACE FECHA WITH XFECHA,POLIZA WITH 2
   REPLACE CUENTA WITH 4105,SCUENTA WITH 1,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE VALOR WITH XTPISO,MOVIMIENTO WITH '-'
   REPLACE TIPO WITH 'I',PERIODO WITH XMESPOL
ENDIF



XARC=SUBSTR(XTERMINAL,1,6)
SELECT 6
SORT ON MOVIMIENTO,CUENTA,SCUENTA,SSCUENTA TO &XARC
CLOSE DATABASES
SELECT 3
USE &XPATCB\POLIZA INDEX &XPATCB\POLIZA,&XPATCB\POLCTA
APPEND FROM &XARC
SET DATE DMY
CLOSE DATABASES

@14,20 SAY 'SE GENERO LA SIGUIENTE POLIZA:'
@16,20 SAY 'Numero 2 INGRESOS DEL : ' GET XFECHA
@20,20 SAY '                                '
CLEAR GETS
WAIT ''
RETURN
