*  GENERA LOS GASTOS DE CHEQUES
*
STORE DATE() TO XFECHAI,XFECHAF
XFECHAI = XFECHAI-DAY(XFECHAI)+1
SINO    = 'NO'
XDEST   = 'T'
@04,1 TO 21,78 CLEAR
@23,1 SAY SPACE(77)
XTITULO='REPORTE DE GASTOS DE CHEQUES'
@4,20  SAY XTITULO
@08,20 SAY 'Teclee Fecha Inicial :        ' GET XFECHAI
@10,20 SAY 'Teclee Fecha Final :          ' GET XFECHAF
@12,10 SAY 'Desea Registrar Esta Informacion en el Inventario: ' GET SINO PICT '@M SI,NO'
@18,20 SAY 'Informacion en <I>mpresora O <T>erminal : ' GET XDEST PICT '@M I,T'
@23,25 SAY '<ESC> Terminar'
READ
IF LASTKEY() = 27 
   CLOSE DATABASES
   RETURN
ENDIF
IF SINO = 'SI'
   SINO = 'NO'
   @20,5 SAY 'Esta Seguro Que Desea Registrar Esta Informacion en el Inventario: ' GET SINO PICT '@M SI,NO'
   @23,25 SAY '<ESC> Terminar'
   READ
ENDIF   
IF LASTKEY() = 27 
   CLOSE DATABASES
   RETURN
ENDIF
SELECT 5
USE IPMAESTRO INDEX IPMAESTRO
SELECT 3
USE &XPATCB\POLIZA INDEX &XPATCB\POLIZA
SORT ON ARTICULO,FECHA FOR FECHA >= XFECHAI .AND. FECHA <=XFECHAF .AND. (CUENTA = 1130 .OR. CUENTA = 1135) TO &XTERMINAL
SELECT 4
USE &XTERMINAL
SET FILTER TO (REFERENCIA = 'DEP:' .OR. REFERENCIA = 'CHK:' .OR. REFERENCIA = 'CCC:') .AND. SUBSTR(CONCEPTO,1,1) <> "*" .AND. SUBSTR(CONCEPTO,1,1) <> "%"
GO TOP
IF EOF()
   CLOSE DATABASES
   RETURN
ENDIF
NLPP = 63
NPAG  = 0
N     = NLPP
XNLPP = NLPP
SET DEVICE TO PRINT
IF XDEST = 'T'
   XT=XTERMINAL+'.TXT'
   SET PRINTER TO &XT
ENDIF
@0,0 SAY CHR(18)
STORE 0 TO XTTVALOR,XTINTERF
DO WHILE .NOT. EOF()
   XARTICULO = SUBSTR(ARTICULO,1,14)
   STORE 0 TO XTVALOR
   DO WHILE SUBSTR(ARTICULO,1,14) = XARTICULO .AND. .NOT. EOF()
         IF N >= XNLPP
            NPAG = NPAG + 1
            @0,4   SAY FFFFFF PICT '@E'
            @0,15  SAY TIME()
            @0,118 SAY 'PAG :'
            @0,124 SAY NPAG PICT '999'
            IF XDEST ='I'
               @1,4 SAY  CHR(18)+CHR(14)
               @1,(44-LEN(XCIA))/2 SAY XCIA
               @2,4 SAY CHR(15)+CHR(14)
               @2,(70-LEN(XTITULO))/2 SAY XTITULO
               @3, 47 SAY 'DEL ' + DTOC(XFECHAI) + '  AL  ' + DTOC(XFECHAF)
            ELSE
               @1,20 SAY XCIA
               @2,20 SAY XTITULO
               @3,20 SAY 'DEL ' + DTOC(XFECHAI) + '  AL  ' + DTOC(XFECHAF)
               XNLPP = 10000
            ENDIF
            @4,10  SAY 'C O N C E P T O'
            @4,65  SAY 'ARTICULO'
            @4,85  SAY 'FECHA'
            @4,98  SAY 'POLIZA'
            @4,105 SAY 'REFERENCIA'
            @4,123 SAY 'VALOR'
            @5, 1 SAY REPLICATE('=',130)
         N=5
         ENDIF
         N=N+1
         @N,10 SAY CONCEPTO 
         @N,65 SAY ARTICULO
         @N,85 SAY FECHA 
         @N,100 SAY POLIZA PICT '9999'
         @N,105 SAY REFERENCIA PICT 'XXXXXXXXXX'
         @N,116 SAY VALOR PICT '999,999,999.99'
         @N,130 SAY MOVIMIENTO PICT 'X'
         IF MOVIMIENTO = '+'
            XTVALOR = XTVALOR + VALOR
         ELSE
            XTVALOR = XTVALOR - VALOR
         ENDIF
         SKIP
   ENDDO      
   SELECT 5
   SEEK XARTICULO
   IF EOF()
      XNARTICULO = "NO EXISTE FAVOR DE CORREGIR"
   ELSE
      XNARTICULO = SUBSTR(NOMBRE,1,30)
      XTINTERF    = XTINTERF    + XTVALOR
   ENDIF   
   SELECT 4
   N = N + 1
   @N,0 SAY CHR(15)+CHR(14)
   @N,01 SAY 'TOTAL:'+XNARTICULO
   @N,050 SAY XTVALOR    PICT '999,999,999.99'
   N = N + 1
   XTTVALOR    = XTTVALOR    + XTVALOR
ENDDO
@N,116 SAY '--------------'
N = N + 1
@N,40 SAY 'PARA INVENTARIO'
@N,56  SAY XTINTERF    PICT '999,999,999.99'
@N,80 SAY 'TOTAL GENERAL'
@N,116  SAY XTTVALOR    PICT '999,999,999.99'
EJECT
SET DEVICE TO SCREEN
CLOSE DATABASES
IF XDEST = 'T'
   DO TERMINAL
ENDIF
IF SINO = 'SI'
   DO GRABA
ENDIF   

RETURN


PROCEDURE GRABA
SELECT 1
USE IPMAESTRO INDEX IPMAESTRO
SELECT 3
USE IPENTRADA INDEX IPENTRADA,IPENTART
SELECT 4
USE &XTERMINAL
SET FILTER TO (REFERENCIA = 'DEP:' .OR. REFERENCIA = 'CHK:' .OR. REFERENCIA = 'CCC:') .AND. SUBSTR(CONCEPTO,1,1) <> "*" .AND. SUBSTR(CONCEPTO,1,1) <> "%"
GO TOP
DO WHILE .NOT. EOF()
   XARTICULO = ARTICULO
   XFECHA = FECHA
   STORE 0 TO XTVALOR
   IF MOVIMIENTO = '+'
      XTVALOR = XTVALOR + VALOR
   ELSE
      XTVALOR = XTVALOR - VALOR
   ENDIF
   SELECT 1
   SEEK SUBSTR(XARTICULO,1,14)
   XGRUPO = GRUPO
   IF .NOT. EOF()
         SELECT 3
         APPEND BLANK
         REPLACE ARTICULO WITH XARTICULO,FECHA WITH XFECHA,FECHAC WITH XFECHA,FOLIO WITH DAY(XFECHA)+10000
         REPLACE VALOR WITH XTVALOR,CLAVE WITH 2,GRUPO WITH XGRUPO
         REPLACE FECHAD WITH XFECHA,OBSERV WITH 'GASTOS DEL '+DTOC(XFECHA)
   ENDIF
   SELECT 4
   SKIP
ENDDO
CLOSE DATABASES