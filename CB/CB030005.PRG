*    ESTE REPORTE OBTIENE LA BALANZA DE COMPROBACION
*
@ 4, 1 TO 21,78 CLEAR
@23, 1 SAY SPACE(78)
XTITULO = 'BALANZA DE COMPROBACION'
SINO    = 'S'
XDEST   = 'T'
XFECHA  = FFFFFF
XNIV = 4
@5,20 SAY XTITULO
@10,15 SAY 'Teclee Fecha a la Cual Quiere la Balanza  : ' GET XFECHA
@12,15 SAY 'Tecle el Nivel al Cual Quiere la Balanza  : ' GET XNIV PICT '9' RANGE 1,4
@18,20 SAY 'Informacion en <I>mpresora o <T>erminal' GET XDEST PICT '@M I,T'
@23,25 SAY '<ESC> Terminar'
READ
IF LASTKEY() = 27
   RETURN
ENDIF
XMESBAL = MONTH(XFECHA)
XTITULO = XTITULO + ' AL '+STR(DAY(XFECHA),2)+' DE '+NMES(XMESBAL)+' DE '+STR(YEAR(XFECHA),4)
@23, 1 SAY SPACE(78)
SET COLOR TO 7*
@23,20 SAY 'FAVOR DE ESPERAR UN MOMENTO ....'
SET COLOR TO &XCOLOR
SELECT 1
USE &XPATCB\CUENTA INDEX &XPATCB\CUENTA ALIAS CUENTA
SELECT 2
USE &XPATCB\SALDOS INDEX &XPATCB\SALDOS
SET RELATION TO STR(CUENTA,4)+STR(SCUENTA,4)+STR(SSCUENTA,3)+STR(SSSCUENTA,3) INTO CUENTA
NPAG  = 0
N     = NLPP
XNLPP = NLPP
SET DEVICE TO PRINT
IF XDEST = 'T'
   XT=XTERMINAL+'.TXT'
   SET PRINTER TO &XT
ENDIF
??? CHR(15)
STORE 0 TO XCARGOS,XABONOS,XCARGOSI,XABONOSI
STORE 0 TO XTCARGOS,XTABONOS,XTSALDOID,XTSALDOI,XTSALDOA
DO WHILE .NOT. EOF()
   IF N>=XNLPP
      NPAG = NPAG + 1
      @0, 1  SAY FFFFFF
      @0, 10 SAY TIME()
      @0,120 SAY 'PAGINA:'
      @0,127 SAY NPAG PICT '999'
      IF XDEST = 'I'
         ??? CHR(18)+CHR(14)
         @1,(44-LEN(XCIA))/2 SAY XCIA
         ??? CHR(15)+CHR(14)
         @2,(70-LEN(XTITULO))/2 SAY XTITULO
      ELSE
         @1,(137-LEN(XCIA))/2 SAY XCIA
         @2,(137-LEN(XTITULO))/2 SAY XTITULO
         XNLPP = 10000
      ENDIF
      @4, 2  SAY 'CUENTA'
      @4,20  SAY 'N O M B R E'
      @4,60  SAY '  SALDO INICIAL'
      @4,78  SAY '         CARGOS'
      @4,96  SAY '         ABONOS'
      @4,114 SAY '    SALDO FINAL'
      @5, 1 SAY REPLICATE('=',130)
      N=5
   ENDIF
   XCUENTA = CUENTA
   XSCUENTA = SCUENTA
   XSSCUENTA = SSCUENTA
   XSSSCUENTA = SSSCUENTA
   XNOMBRE = CUENTA->NOMBRE
   IF XNIV = 4
   DO WHILE STR(XCUENTA,4)+STR(XSCUENTA,4)+STR(XSSCUENTA,3)+STR(XSSSCUENTA,3) = STR(CUENTA,4)+STR(SCUENTA,4)+STR(SSCUENTA,3)+STR(SSSCUENTA,3) .AND. .NOT. EOF()
      IF PERIODO = XMESBAL
         XCARGOS = XCARGOS + CARGOS
         XABONOS = XABONOS + ABONOS
      ENDIF
      IF PERIODO < XMESBAL
         XCARGOSI = XCARGOSI + CARGOS
         XABONOSI = XABONOSI + ABONOS
      ENDIF
      SKIP
   ENDDO
   ENDIF
   IF XNIV = 3
   DO WHILE STR(XCUENTA,4)+STR(XSCUENTA,4)+STR(XSSCUENTA,3) = STR(CUENTA,4)+STR(SCUENTA,4)+STR(SSCUENTA,3) .AND. .NOT. EOF()
      IF PERIODO = XMESBAL
         XCARGOS = XCARGOS + CARGOS
         XABONOS = XABONOS + ABONOS
      ENDIF
      IF PERIODO < XMESBAL
         XCARGOSI = XCARGOSI + CARGOS
         XABONOSI = XABONOSI + ABONOS
      ENDIF
      SKIP
   ENDDO
   ENDIF
   IF XNIV = 2
   DO WHILE STR(XCUENTA,4)+STR(XSCUENTA,4) = STR(CUENTA,4)+STR(SCUENTA,4) .AND. .NOT. EOF()
      IF PERIODO = XMESBAL
         XCARGOS = XCARGOS + CARGOS
         XABONOS = XABONOS + ABONOS
      ENDIF
      IF PERIODO < XMESBAL
         XCARGOSI = XCARGOSI + CARGOS
         XABONOSI = XABONOSI + ABONOS
      ENDIF
      SKIP
   ENDDO
   ENDIF
   IF XNIV = 1
   DO WHILE STR(XCUENTA,4) = STR(CUENTA,4) .AND. .NOT. EOF()
      IF PERIODO = XMESBAL
         XCARGOS = XCARGOS + CARGOS
         XABONOS = XABONOS + ABONOS
      ENDIF
      IF PERIODO < XMESBAL
         XCARGOSI = XCARGOSI + CARGOS
         XABONOSI = XABONOSI + ABONOS
      ENDIF
      SKIP
   ENDDO
   ENDIF
   XSALDOI = XCARGOSI - XABONOSI
   XSALDOA = XSALDOI  + XCARGOS - XABONOS
   IF XSALDOI <> 0 .OR. XCARGOS <> 0 .OR. XABONOS <> 0 .OR. XSALDOA <> 0
      N=N+1
      @N,1   SAY STR(XCUENTA,4)+STR(XSCUENTA,4)+STR(XSSCUENTA,3)+STR(XSSSCUENTA,3) 
      @N,16  SAY XNOMBRE 
      @N,60  SAY XSALDOI PICT '99,999,999,999.99' FUNCTION 'Z'
      @N,78  SAY XCARGOS PICT '99,999,999,999.99' FUNCTION 'Z'
      @N,96  SAY XABONOS PICT '99,999,999,999.99' FUNCTION 'Z'
      @N,114 SAY XSALDOA PICT '99,999,999,999.99' FUNCTION 'Z'
      XTSALDOI = XTSALDOI + XSALDOI
      XTSALDOA = XTSALDOA + XSALDOA
      XTCARGOS = XTCARGOS + XCARGOS
      XTABONOS = XTABONOS + XABONOS
   ENDIF
   STORE 0 TO XCARGOS,XABONOS,XCARGOSI,XABONOSI
ENDDO
N = N + 1
@N, 1 SAY REPLICATE('=',139)
N = N + 1
@N,12  SAY 'SUMAS IGUALES :'
@N,60  SAY XTSALDOI  PICT '99,999,999,999.99'  FUNCTION 'Z'
@N,78  SAY XTCARGOS  PICT '99,999,999,999.99'  FUNCTION 'Z'
@N,96  SAY XTABONOS  PICT '99,999,999,999.99'  FUNCTION 'Z'
@N,114 SAY XTSALDOA  PICT '99,999,999,999.99'  FUNCTION 'Z'
EJECT
SET DEVICE TO SCREEN
CLOSE DATABASES
IF XDEST = 'T'
   DO TERMINAL
ENDIF
RETURN
