* PROCESO DE CIERRE DE ANO
*
SELECT 1
USE CIAS
DO WHILE .T.
   @ 4,1  TO 21,78 CLEAR
   @ 23,1 SAY SPACE(78)
   IF MEMORY() < 90
      @10,20 SAY 'NO TIENE SUFICIENTE MEMORIA PARA DAR'
      @12,20 SAY 'EL CIERRE ANUAL DE UNA EMPRESA......'
      @14,20 SAY 'MEMORIA REQUERIDA > 95000'
      @16,20 SAY 'MEMORIA DIPONIBLE :'
      @16,40 SAY MEMORY()*1000 PICT '99999'
      WAIT ''
      CLOSE DATABASES
      RETURN
   ENDIF
   @ 4,25 SAY 'CIERRE ANUAL DE EMPRESAS'
   SINO = 'SI'
   @ 23,6 SAY  CHR(24)+' '+CHR(25)+' Seleccionar     ';
   +CHR(17)+CHR(196)+CHR(217)+' Confirmar     <ESC> Terminar'
   ACTI POPUP POPEMPRESA
   IF LASTKEY() = 27
      EXIT
   ENDIF
   IF LASTKEY() = 4
      LOOP
   ENDIF
   IF LASTKEY() = 19
      LOOP
   ENDIF
   XNOMBRE  = NOMBRE
   XNOMBRET = NOMBRET
   XDIRECC  = DIRECC
   XCIUDAD  = CIUDAD
   XUNIDAD  = UNIDAD
   YUNIDAD  = TRIM(UNIDAD)
   XRFC     = RFC
   XNLPP    = NLPP
   XCTA     = CCTAMAYOR
   @ 6,10   SAY 'Nombre :    ' GET XNOMBRE
   @ 7,10   SAY 'Direccion : ' GET XDIRECC
   @ 8,10   SAY 'Ciudad :    ' GET XCIUDAD
   @ 10,10  SAY 'R. F. C. :  ' GET XRFC
   XUNIDAD = '        '
   CLEAR GETS
   @ 12,10  SAY 'Nombre de Trabajo Nuevo : ' GET XNOMBRET
   @ 14,10  SAY 'Nombre del NUEVO Directorio en donde estaran '
   @ 15,10  SAY 'los Archivos de Datos ejem: [ VITRO92 o VITRO93 o VITRO94 ] '
   @ 16,10  SAY 'Se Recomienda esta forma para saber donde se encuentran'
   @ 17,10  SAY 'los Archivos de Datos de Cada Periodo : ' GET XUNIDAD PICT 'XXXXXXXX'
   @ 23,1  SAY SPACE(78)
   @ 23,20 SAY 'ES CORRECTA LA INFORMACION  SI/NO ? ' GET SINO PICT '!!'
   READ
   IF XUNIDAD = '        '
      LOOP
   ENDIF
   IF SINO <> 'SI'
      LOOP
   ENDIF
   XUNIDAD = CURDIR()+TRIM(XUNIDAD)
   RUN MD &XUNIDAD
   SELECT 2
   ?XUNIDAD
   ?YUNIDAD
   USE &YUNIDAD\CUENTA
   COPY TO &XUNIDAD\CUENTA
   USE
   SELECT 6
   USE &XUNIDAD\CUENTA
   INDEX ON CUENTA TO &XUNIDAD\CUENTA
   SET FILTER TO CUENTA > '4'
   REPLACE ALL CARGOS WITH 0,ABONOS WITH 0
   USE
   SELECT 3
   USE SLDS
   COPY STRUC TO &XUNIDAD\SALDOS
   SELECT 3
   USE &XUNIDAD\SALDOS
   INDEX ON CUENTA+STR(MES,2,0) TO &XUNIDAD\SALDOS
   USE
   SELECT 4
   USE PLZA
   COPY STRUC TO &XUNIDAD\POLIZA
   SELECT 4
   USE &XUNIDAD\POLIZA
   INDEX ON DTOC(FECHA)+STR(POLIZA,4,0) TO &XUNIDAD\POLIZA
   INDEX ON CUENTA+DTOC(FECHA)+STR(POLIZA,4,0) TO &XUNIDAD\POLCTA
   USE
   SELECT 1
   APPEND BLANK
   REPLACE NOMBRE WITH XNOMBRE,DIRECC WITH XDIRECC,CIUDAD WITH XCIUDAD
   REPLACE UNIDAD WITH XUNIDAD,RFC WITH XRFC,NLPP WITH XNLPP
   REPLACE CCTAMAYOR WITH XCTA,NOMBRET WITH XNOMBRET
   @ 18,10 SAY 'OK PROCESO TERMINADO ....................'
   @ 19,10 SAY 'SE RECOMIENDA MANDAR LOS PROCESOS DE ORGANIZA DATOS'
   @ 20,10 SAY 'Y GENERA SALDOS DE LAS CUENTAS PARA COMPLETAR LA INFORMACION'
   @ 21,10 SAY 'TECLEE RETURN PARA TERMINAR'
   WAIT ''
   EXIT
ENDDO
CLOSE DATABASES
RETURN