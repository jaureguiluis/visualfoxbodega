*9    DON FIDEL
*8    LULU
*7    CONTADORA
*6    GERENTE
*5    SUBGERENTE
*4    VENDEDOR
*3    SECRETARIA
*2    ALMACENISTA
*1    AUXILIAR

DEFI POPUP POPPASS FROM 5,25  PROMPT FIELD USUARIO TITLE 'USUARIO'
ON SELECTION POPUP POPPASS DEAC POPUP POPPASS

DEFI WIND WPASS FROM 10,20 TO 15,61 COLOR SCHEME 8
SELECT 10
USE PASSWORD
STORE SPACE(15) TO XUSUARIO
STORE SPACE(10) TO XCR5678L
XPASS = 0
X = 0
DO WHILE .T.
   STORE SPACE(10) TO YCR5678L
   STORE SPACE(15) TO XUSUARIO
   IF X >= 2
      CLOSE DATA
      USE
      DEACT WIND WPASS
      QUIT
   ENDIF   
   DEACT WIND WPASS
   @4,5 SAY 'Busque su Nombre y Teclee Enter para dar su Password '
   ACTI POPUP POPPASS
   @20,5 SAY '                                                     '
   XUSUARIO = USUARIO
   IF LASTKEY()=27
      QUIT
   ENDIF   
   LOCATE FOR XUSUARIO = USUARIO
   IF EOF()
      WAIT ' USUARIO NO EXISTE TECLEE RETURN ' WIND
      X = X + 1
      LOOP
   ENDIF   
   ACTI WIND WPASS
   XTERMINAL = TERMINAL
   XFIRMA    = USUARIO
   @0,1 SAY USUARIO
   @1,1 SAY 'Teclee Password :  ' GET YCR5678L PICT '9999999999' COLOR 6,8/8
   @2,1 SAY '<ESC> Modificacion'
   READ
   XPS = 0
   @2,1 SAY '                                     '
   IF LASTKEY() = 27
      XPS = 99
      @3,1 SAY '1=Modificacion 2= Nuevo  3= Borrar ' GET XPS PICT '9'
      READ
   ENDIF
*   
*  NUEVO
*   
   IF XPS = 2   
      IF NIVEL >= 7
         @1,1 SAY 'Teclee Password :  ' GET YCR5678L PICT '9999999999' COLOR 6,8/8
         @3,1 SAY '               2= Nuevo              '                 
         READ
         DO ARMA
         IF XCR5678L = CR5678L
            STORE SPACE(10) TO XUSUARIO
            STORE SPACE(10) TO YCR5678L
            CLEAR
            XNIVEL = 1
            @0,1 SAY 'Usuario Nuevo   :  ' GET XUSUARIO 
            READ
            IF XUSUARIO = '  '
              WAIT ' USUARIO EN BLANCO NO SE DA DE ALTA' WIND   
              QUIT             
            ENDIF       
            @1,1 SAY 'Teclee Password :  ' GET YCR5678L PICT '9999999999' COLOR 3,8/8
            READ
            @2,1 SAY 'Nivel (1 a 9) :    ' GET XNIVEL PICT '99'
            READ
            DO ARMA
            LOCATE FOR XUSUARIO = USUARIO
            IF EOF()
               APPEND BLANK
               REPLACE CR5678L WITH XCR5678L,USUARIO WITH XUSUARIO,NIVEL WITH XNIVEL,TERMINAL WITH ALLTRIM(XUSUARIO)+'ABCDEFGHI',FECHAF WITH FFFFFF
               USE
            ENDIF   
            DEACT WIND WPASS
         QUIT
        ENDIF
     ELSE
        WAIT ' USUARIO NO AUTORIZADO A DAR DE ALTA' WIND   
     ENDIF    
   ENDIF      
*
* BORRAR
*
   IF XPS = 3   
      IF NIVEL >= 6
         @1,1 SAY 'Teclee Password :  ' GET YCR5678L PICT '9999999999' COLOR 6,8/8
         @3,1 SAY '                         3= Borrar    '        
         READ
         DO ARMA
         IF XCR5678L = CR5678L
            STORE SPACE(10) TO XUSUARIO
            STORE SPACE(10) TO YCR5678L
            CLEAR
            @0,1 SAY 'Usuario a Borrar:  ' GET XUSUARIO 
            READ
            LOCATE FOR USUARIO = XUSUARIO
            IF EOF()
               WAIT "NO EXISTE"
            ENDIF   
            DELETE
            DEACT WIND WPASS
           QUIT
        ENDIF
     ELSE
        WAIT ' USUARIO NO AUTORIZADO A DAR DE BAJA' WIND   
     ENDIF    
   ENDIF      
*
*    CAMBIAR
*
   IF XPS = 1
      @1,1 SAY 'Teclee Password Anterior : ' GET YCR5678L PICT '9999999999' COLOR 3,8/8
      @3,1 SAY '1=Modificacion                        '
      READ
      DO ARMA
      IF XCR5678L = CR5678L
         STORE SPACE(10) TO YCR5678L
         @2,1 SAY 'Teclee Password Nuevo ' GET YCR5678L PICT '9999999999' COLOR 6,8/8
         READ
         DO ARMA
         REPLACE CR5678L WITH XCR5678L,FECHAF WITH FFFFFF
         USE
         DEACT WIND WPASS
         QUIT
      ENDIF
   ENDIF
         
   IF XPS = 0
      DO ARMA
      XNIVEL = NIVEL
      IF XCR5678L = CR5678L
         XPASS = 1
         EXIT
      ELSE
         WAIT ' PASSWORD INCORRECTO NO TIENE DERECHO A ESTE MODULO  ' WIND
         X = X + 1
         LOOP
      ENDIF   
   ELSE
      QUIT
   ENDIF      
   QUIT   
ENDDO
USE
DEACT WIND WPASS

* BORRAR






PROCEDURE ARMA
   V1=SUBSTR(YCR5678L,1,1)
   C1=ALLTRIM(STR(VAL(V1)*9))
   P1=STR(ASC(C1),2)
   
   V2=SUBSTR(YCR5678L,1,1)
   C2=ALLTRIM(STR(VAL(V2)*7))
   P2=STR(ASC(C2),2)
 
   V3=SUBSTR(YCR5678L,1,1)
   C3=ALLTRIM(STR(VAL(V3)))
   P3=STR(ASC(C3),2)
   
   V4=SUBSTR(YCR5678L,2,1)
   C4=ALLTRIM(STR(VAL(V4)*9))
   P4=STR(ASC(C4),2)
   
   V5=SUBSTR(YCR5678L,2,1)
   C5=ALLTRIM(STR(VAL(V5)*7))
   P5=STR(ASC(C5),2)
 
   V6=SUBSTR(YCR5678L,2,1)
   C6=ALLTRIM(STR(VAL(V6)))
   P6=STR(ASC(C6),2)

   V7=SUBSTR(YCR5678L,3,1)
   C7=ALLTRIM(STR(VAL(V7)*9))
   P7=STR(ASC(C7),2)
   
   V8=SUBSTR(YCR5678L,3,1)
   C8=ALLTRIM(STR(VAL(V8)*7))
   P8=STR(ASC(C8),2)
 
   V9=SUBSTR(YCR5678L,3,1)
   C9=ALLTRIM(STR(VAL(V9)))
   P9=STR(ASC(C9),2)

   V0=SUBSTR(YCR5678L,4,1)
   C0=ALLTRIM(STR(VAL(V0)*9))
   P0=STR(ASC(C0),2)
   
   V11=SUBSTR(YCR5678L,4,1)
   C11=ALLTRIM(STR(VAL(V11)*7))
   P11=STR(ASC(C11),2)
 
   V12=SUBSTR(YCR5678L,4,1)
   C12=ALLTRIM(STR(VAL(V12)))
   P12=STR(ASC(C12),2)

   V13=SUBSTR(YCR5678L,5,1)
   C13=ALLTRIM(STR(VAL(V13)*9))
   P13=STR(ASC(C13),2)
   
   V14=SUBSTR(YCR5678L,5,1)
   C14=ALLTRIM(STR(VAL(V14)*7))
   P14=STR(ASC(C14),2)
 
   V15=SUBSTR(YCR5678L,5,1)
   C15=ALLTRIM(STR(VAL(V15)))
   P15=STR(ASC(C15),2)

   V16=SUBSTR(YCR5678L,6,1)
   C16=ALLTRIM(STR(VAL(V16)*9))
   P16=STR(ASC(C16),2)
   
   V17=SUBSTR(YCR5678L,6,1)
   C17=ALLTRIM(STR(VAL(V17)*7))
   P17=STR(ASC(C17),2)
 
   V18=SUBSTR(YCR5678L,6,1)
   C18=ALLTRIM(STR(VAL(V18)))
   P18=STR(ASC(C18),2)

   V19=SUBSTR(YCR5678L,7,1)
   C19=ALLTRIM(STR(VAL(V19)*9))
   P19=STR(ASC(C19),2)
   
   V20=SUBSTR(YCR5678L,7,1)
   C20=ALLTRIM(STR(VAL(V20)*7))
   P20=STR(ASC(C20),2)
 
   V21=SUBSTR(YCR5678L,7,1)
   C21=ALLTRIM(STR(VAL(V21)))
   P21=STR(ASC(C21),2)


   V22=SUBSTR(YCR5678L,8,1)
   C22=ALLTRIM(STR(VAL(V22)*9))
   P22=STR(ASC(C22),2)
   
   V23=SUBSTR(YCR5678L,8,1)
   C23=ALLTRIM(STR(VAL(V23)*7))
   P23=STR(ASC(C23),2)
 
   V24=SUBSTR(YCR5678L,8,1)
   C24=ALLTRIM(STR(VAL(V24)))
   P24=STR(ASC(C24),2)


   V25=SUBSTR(YCR5678L,9,1)
   C25=ALLTRIM(STR(VAL(V25)*9))
   P25=STR(ASC(C25),2)
   
   V26=SUBSTR(YCR5678L,9,1)
   C26=ALLTRIM(STR(VAL(V26)*7))
   P26=STR(ASC(C26),2)
 
   V27=SUBSTR(YCR5678L,9,1)
   C27=ALLTRIM(STR(VAL(V27)))
   P27=STR(ASC(C27),2)


   V28=SUBSTR(YCR5678L,10,1)
   C28=ALLTRIM(STR(VAL(V28)*9))
   P28=STR(ASC(C28),2)
   
   V29=SUBSTR(YCR5678L,10,1)
   C29=ALLTRIM(STR(VAL(V29)*7))
   P29=STR(ASC(C29),2)
 
   V30=SUBSTR(YCR5678L,10,1)
   C30=ALLTRIM(STR(VAL(V30)))
   P30=STR(ASC(C30),2)
   
*   XCR5678L = P1+P2+P3+P4+P5+P6+P7+P8+P9+P0+P11+P12+P13+P14+P15+P16+P17+P18+P19+P20+P21+P22+P23+P24+P25+P26+P27+P28+P29+P30
   XCR5678L = SUBSTR(P1,2,1)+SUBSTR(P2,2,1)+SUBSTR(P3,2,1)+SUBSTR(P4,2,1)+SUBSTR(P5,2,1)+SUBSTR(P6,2,1)+SUBSTR(P7,2,1)+SUBSTR(P8,2,1)+SUBSTR(P9,2,1)+SUBSTR(P0,2,1)+SUBSTR(P11,2,1)+SUBSTR(P12,2,1)+SUBSTR(P13,2,1)+SUBSTR(P14,2,1)+SUBSTR(P15,2,1)+SUBSTR(P16,2,1)+SUBSTR(P17,2,1)+SUBSTR(P18,2,1)+SUBSTR(P19,2,1)+SUBSTR(P20,2,1)+SUBSTR(P21,2,1)+SUBSTR(P22,2,1)+SUBSTR(P23,2,1)+SUBSTR(P24,2,1)+SUBSTR(P25,2,1)+SUBSTR(P26,2,1)+SUBSTR(P27,2,1)+SUBSTR(P28,2,1)+SUBSTR(P29,2,1)+SUBSTR(P30,2,1)+'                              '
   
