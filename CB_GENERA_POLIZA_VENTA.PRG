*
*   GENERA LA POLIZA 1 DIARIA DE VENTAS NUEVA EMPRESA
*
*SET DATE ANSI
XMESPOL = MONTH(FFFFFF)
*Xfechai = ffffff
*xfechaf = ffffff
SELECT 1
USE CCCLIENTE 
set order to cliente
SELECT 3
USE cbPOLIZA
set order to poliza
SEEK DTOC(Xfechai)+"D"+STR(1,6,0)
IF .NOT. EOF()
   cMessageText = 'YA EXISTEN UNA POLIZA DEL DIA'
   cMessTitlavis= 'Cuidado'
   nAnswer = MESSAGEBOX(cMessageText,cMessTitlavis)
   CLOSE TABLE ALL
   RETURN
ENDIF   
COPY STRUC TO &XTERMINAL
SELECT 7
USE IPMAESTRO
SELECT 6
USE &XTERMINAL
SELECT 5
USE IPGRUPO
XARC=SUBSTR(XTERMINAL,1,7)
SELECT 9
USE IPJUNTAR  
COPY STRUC TO &XARC
SELECT 9
USE &XARC
INDEX ON GRUPO+ARTICULO+STR(CLAVE,2) TO &XTERMINAL
APPEND FROM IPENTRADA FOR FECHAC >= Xfechai .AND. FECHAC <= XFECHAF
APPEND FROM IPSALIDA  FOR FECHAC >= Xfechai .AND. FECHAC <= XFECHAF
GO TOP
IF EOF()
*   SET DATE DMY
   cMessageText = 'NO HAY DATOS EN EL RANGO DE FECHAS'
   cMessTitlavis= 'Aviso!!!!!'
   nAnswer = MESSAGEBOX(cMessageText,cMessTitlavis)
   CLOSE DATABASES
   RETURN
ENDIF   
STORE 0 TO XT1VALOR,XT3VALOR,XT7VALOR,XT9VALOR,XT79VALOR,XT51VALOR,XT51CVALOR,XT51DVALOR,XT52VALOR,XT52CVALOR,XT53VALOR,XT54VALOR,XT58VALOR,XT59VALOR,XT60VALOR,XT10VALOR
SELECT 5
DO WHILE .NOT. EOF()
   XGRUPO   = NUMERO
   XNOMBRE  = NOMBRE
   XSCUENTA = VAL(GRUPOA)
   SELECT 9
   SEEK XGRUPO
   DO WHILE GRUPO = XGRUPO .AND. .NOT. EOF()
      XARTICULO = ARTICULO
      XPROPIO   = SUBSTR(ARTICULO,1,1)
      IF XPROPIO = 'P'
         XCUENTA = 1130
      ELSE
         XCUENTA = 1135
      ENDIF   
      STORE 0 TO X1VALOR,X3VALOR,X7VALOR,X9VALOR,X79VALOR,X51VALOR,X51CVALOR,X51DVALOR,X52VALOR,X52CVALOR,X53VALOR,X54VALOR,X58VALOR,X59VALOR,X60VALOR,X10VALOR
      DO WHILE GRUPO = XGRUPO .AND. SUBSTR(ARTICULO,1,1) = XPROPIO .AND. .NOT. EOF()
         XCLIENTE = CLIENTE
         SELECT 1
         SEEK XCLIENTE
         XMN = CLAVE
         SELECT 9

         IF XMN = 'D'
            X51DVALOR    = X51DVALOR    + VALOR
         ELSE
           IF XPROPIO = 'C'
              IF CLAVE = 51 
                 X51CVALOR    = X51CVALOR    + VALOR
              ENDIF
              IF CLAVE = 52 
                 X52CVALOR    = X52CVALOR    + VALOR
              ENDIF
           ELSE      
              IF CLAVE = 51 
                 X51VALOR    = X51VALOR    + VALOR
              ENDIF
              IF CLAVE = 52 
                 X52VALOR    = X52VALOR    + VALOR
              ENDIF
           ENDIF   
         ENDIF   

         IF CLAVE = 54 
            X54VALOR    = X54VALOR    + VALOR
         ENDIF
         IF CLAVE = 1 
            X1VALOR    = X1VALOR    + VALOR
         ENDIF
         IF CLAVE = 79 
            X79VALOR    = X79VALOR    + VALOR
         ENDIF
         IF CLAVE = 3 
            X3VALOR    = X3VALOR    + VALOR
         ENDIF
         IF CLAVE = 7 
            X7VALOR    = X7VALOR    + VALOR
         ENDIF
         IF CLAVE = 58 
            X58VALOR    = X58VALOR    + VALOR
         ENDIF
         IF CLAVE = 59 
            X59VALOR    = X59VALOR    + VALOR
         ENDIF
         IF CLAVE = 60 
            X60VALOR    = X60VALOR    + VALOR
         ENDIF
         IF CLAVE = 9 .OR. CLAVE = 8 .OR. CLAVE = 53
*           BONIFICACION INDIVIDUAL
            X9VALOR  = X9VALOR    + VALOR
            XVALOR   = VALOR
            XCLIENTE = CLIENTE
            XFOLIO   = FOLIO
            SELECT 1
            SEEK XCLIENTE
            XCLIENTE = SUBSTR(NOMBRE,1,21)
            SELECT 6
            APPEND BLANK
            REPLACE FECHA WITH Xfechai,POLIZA WITH 1
            REPLACE CUENTA WITH 4110,SCUENTA WITH 1,SSCUENTA WITH 0,SSSCUENTA WITH 0
            REPLACE VALOR WITH XVALOR,MOVIMIENTO WITH '+'
            REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
            REPLACE CONCEPTO WITH XCLIENTE+' F/'+STR(XFOLIO,6)
            IF XPROPIO = 'C'
               REPLACE SCUENTA WITH 2
            ENDIF
            SELECT 9
         ENDIF
         IF CLAVE = 59 
*           CANCELACION BONIFICACION INDIVIDUAL
            X59VALOR    = X59VALOR    + VALOR
            XVALOR = VALOR
            XCLIENTE = CLIENTE
            XFOLIO = FOLIO
            SELECT 1
            SEEK XCLIENTE
            XCLIENTE = SUBSTR(NOMBRE,1,21)
            SELECT 6
            APPEND BLANK
            REPLACE FECHA WITH Xfechai,POLIZA WITH 1
            REPLACE CUENTA WITH 4110,SCUENTA WITH 1,SSCUENTA WITH 0,SSSCUENTA WITH 0
            REPLACE VALOR WITH XVALOR,MOVIMIENTO WITH '-'
            REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
            REPLACE CONCEPTO WITH XCLIENTE+' F/'+STR(XFOLIO,6)+' CANCELACION'
            IF XPROPIO = 'C'
               REPLACE SCUENTA WITH 2
            ENDIF
            SELECT 9
         ENDIF
         IF CLAVE = 10
*           BONIFICACION PUBLICIDAD
            X10VALOR    = X10VALOR    + VALOR
            XVALOR = VALOR
            XCLIENTE = CLIENTE
            XFOLIO = FOLIO
            SELECT 1
            SEEK XCLIENTE
            XCLIENTE = SUBSTR(NOMBRE,1,21)
            SELECT 6
            APPEND BLANK
            REPLACE FECHA WITH Xfechai,POLIZA WITH 1
            REPLACE CUENTA WITH 5200,SCUENTA WITH 13,SSCUENTA WITH 2,SSSCUENTA WITH 0
            REPLACE VALOR WITH XVALOR,MOVIMIENTO WITH '+'
            REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
            REPLACE CONCEPTO WITH XCLIENTE+' F/'+STR(XFOLIO,6)
            SELECT 9
         ENDIF
         SKIP
      ENDDO
      XT1VALOR    = XT1VALOR    + X1VALOR
      XT3VALOR    = XT3VALOR    + X3VALOR
      XT7VALOR    = XT7VALOR    + X7VALOR
      XT9VALOR    = XT9VALOR    + X9VALOR
      XT51VALOR   = XT51VALOR   + X51VALOR
      XT51DVALOR  = XT51DVALOR  + X51DVALOR
      XT51CVALOR  = XT51CVALOR  + X51CVALOR
      XT52CVALOR  = XT52CVALOR  + X52CVALOR
      XT52VALOR   = XT52VALOR   + X52VALOR
      XT54VALOR   = XT54VALOR   + X54VALOR
      XT79VALOR   = XT79VALOR   + X79VALOR
      XT10VALOR   = XT10VALOR   + X10VALOR

      IF X1VALOR <>0
         SELECT 6
         APPEND BLANK
         REPLACE FECHA WITH Xfechai,POLIZA WITH 1
         REPLACE CUENTA WITH XCUENTA,SCUENTA WITH XSCUENTA,SSCUENTA WITH 1,SSSCUENTA WITH 0
         REPLACE VALOR WITH X1VALOR,MOVIMIENTO WITH '+'
         REPLACE TIPO WITH 'D',REFERENCIA WITH 'CPRA',PERIODO WITH XMESPOL
      ENDIF

      IF X54VALOR <>0
      
*        DEVOLUCION X PROVEEDOR
  
         SELECT 6
         APPEND BLANK
         REPLACE FECHA WITH Xfechai,POLIZA WITH 1
         REPLACE CUENTA WITH XCUENTA,SCUENTA WITH XSCUENTA,SSCUENTA WITH 1,SSSCUENTA WITH 0
         REPLACE VALOR WITH X54VALOR,MOVIMIENTO WITH '-'
         REPLACE TIPO WITH 'D',REFERENCIA WITH 'DEVCPRA',PERIODO WITH XMESPOL
      ENDIF


      SELECT 9
   ENDDO
   SELECT 5
   SKIP
ENDDO
SELECT 6
APPEND BLANK
REPLACE FECHA WITH Xfechai,POLIZA WITH 1
REPLACE CUENTA WITH 2300,SCUENTA WITH 1,SSCUENTA WITH 0,SSSCUENTA WITH 0
REPLACE VALOR WITH XT1VALOR-XT54VALOR,MOVIMIENTO WITH '-'
REPLACE TIPO WITH 'D',REFERENCIA WITH 'CPRA',PERIODO WITH XMESPOL

*  CREDITO    

IF XT51VALOR <>0
   SELECT 6
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 4101,SCUENTA WITH 2,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'VENTA CREDITO 51',VALOR WITH XT51VALOR,MOVIMIENTO WITH '-'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 1110,SCUENTA WITH 2,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'VENTA CREDITO 51',VALOR WITH XT51VALOR,MOVIMIENTO WITH '+'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
ENDIF

*  CONTADO    

IF XT52VALOR <>0
   SELECT 6
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 4101,SCUENTA WITH 1,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'VENTA CONTADO 52',VALOR WITH XT52VALOR,MOVIMIENTO WITH '-'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 1110,SCUENTA WITH 1,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'VENTA CONTADO 52',VALOR WITH XT52VALOR,MOVIMIENTO WITH '+'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
ENDIF

*  EXPORTACION    

IF XT51DVALOR <>0
   SELECT 6
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 4101,SCUENTA WITH 3,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'VENTA EXPORTACION 51',VALOR WITH XT51DVALOR,MOVIMIENTO WITH '-'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 1110,SCUENTA WITH 2,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'VENTA EXPORTACION 51',VALOR WITH XT51DVALOR,MOVIMIENTO WITH '+'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
ENDIF

*  COMISION    

IF XT51CVALOR <>0
   SELECT 6
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 4101,SCUENTA WITH 4,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'VENTA COMISION 51',VALOR WITH XT51CVALOR,MOVIMIENTO WITH '-'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 1110,SCUENTA WITH 2,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'VENTA COMISION 51',VALOR WITH XT51CVALOR,MOVIMIENTO WITH '+'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
ENDIF

*  COMISION    

IF XT52CVALOR <>0
   SELECT 6
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 4101,SCUENTA WITH 4,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'VENTA COMISION 52',VALOR WITH XT52CVALOR,MOVIMIENTO WITH '-'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 1110,SCUENTA WITH 1,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'VENTA COMISION 52',VALOR WITH XT52CVALOR,MOVIMIENTO WITH '+'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
ENDIF

* DEVOLUCION

IF XT3VALOR <>0
   SELECT 6
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 4120,SCUENTA WITH 1,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'DEVOLUCION',VALOR WITH XT3VALOR,MOVIMIENTO WITH '+'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
ENDIF

* CANCELACION DEVOLUCION

IF XT58VALOR <>0
   SELECT 6
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 4120,SCUENTA WITH 1,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'CANCELA DEVOLUCION',VALOR WITH XT58VALOR,MOVIMIENTO WITH '-'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
ENDIF

* CANCELACION

IF XT7VALOR <>0
     SELECT 6
     APPEND BLANK
     REPLACE FECHA WITH Xfechai,POLIZA WITH 1
     REPLACE CUENTA WITH 4101,SCUENTA WITH 2,SSCUENTA WITH 0,SSSCUENTA WITH 0
     REPLACE CONCEPTO WITH 'CANCELACION',VALOR WITH XT7VALOR,MOVIMIENTO WITH '+'
     REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
ENDIF

* CANCELACION CANCELACION

IF XT60VALOR <>0
     SELECT 6
     APPEND BLANK
     REPLACE FECHA WITH Xfechai,POLIZA WITH 1
     REPLACE CUENTA WITH 4101,SCUENTA WITH 2,SSCUENTA WITH 0,SSSCUENTA WITH 0
     REPLACE CONCEPTO WITH 'CANCELA CANCELACION',VALOR WITH XT60VALOR,MOVIMIENTO WITH '-'
     REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
ENDIF
  
* BONIFICACION + CANCELACION + DEVOLUCION

IF XT10VALOR+XT9VALOR+XT3VALOR+XT7VALOR <>0
   SELECT 6
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 1110,SCUENTA WITH 2,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'DEV-CAN-BONI',VALOR WITH XT9VALOR+XT3VALOR+XT7VALOR+XT10VALOR,MOVIMIENTO WITH '-'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
*   IF SUBSTR(PAT,2,2) = "89"
*      REPLACE SCUENTA WITH 50
*   ENDIF   
ENDIF

* CANCELACION DE BONIFICACION + CANCELACION + DEVOLUCION

IF XT58VALOR+XT59VALOR+XT60VALOR <>0
   SELECT 6
   APPEND BLANK
   REPLACE FECHA WITH Xfechai,POLIZA WITH 1
   REPLACE CUENTA WITH 1110,SCUENTA WITH 2,SSCUENTA WITH 0,SSSCUENTA WITH 0
   REPLACE CONCEPTO WITH 'CANCELACION DEV-CAN-BONI',VALOR WITH XT58VALOR+XT59VALOR+XT60VALOR,MOVIMIENTO WITH '+'
   REPLACE TIPO WITH 'D',PERIODO WITH XMESPOL
*   IF SUBSTR(PAT,2,2) = "89"
*      REPLACE SCUENTA WITH 50
*   ENDIF   
ENDIF



XARC=SUBSTR(XTERMINAL,1,6)
SELECT 6
SORT ON MOVIMIENTO,CUENTA,SCUENTA,SSCUENTA TO &XARC
CLOSE DATABASES
SELECT 3
USE cbPOLIZA 
APPEND FROM &XARC
*SET DATE DMY
CLOSE TABLE ALL
CLOSE DATABASES
   cMessTitlavis='AVISO..........'
   cMessageText = 'SE GENERO LA POLIZA 1 DEL '+DTOC(Xfechai)
   nAnswer = MESSAGEBOX(cMessageText,cMessTitlavis)


CLEAR GETS
RETURN
